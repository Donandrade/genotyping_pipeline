# genotyping_pipeline
Blueberry Breeding Pipeline

This is a pipeline that processes WGS data starting from raw reads up to variant calling.


# Genotyping Pipeline — README

This pipeline performs **read trimming, alignment, QC, per-sample variant calling, per-chromosome merging**, and **optional probe-based filtering**.  
It is designed for execution as a SLURM array job but can be adapted for other environments.

---

##  Outputs Generated by the Pipeline

The pipeline produces the following groups of files:

### **1. Trimmed FASTQ files**
- `out/<sample>_R1_paired.fq.gz`
- `out/<sample>_R2_paired.fq.gz`

### **2. Aligned BAM files + index**
- `out/bam/<sample>.sorted.group.bam`
- `out/bam/<sample>.sorted.group.bam.bai`

### **3. QC reports (per sample)**
Located in `out/bam_tmp/`:
- `<sample>.flagstat.txt`
- `<sample>.stats.txt`
- `<sample>.idxstats.txt`
- `<sample>.bamvalidate.txt`

### **4. Per-sample VCFs**
- `out/pileup/<sample>_sorted_norm_split.vcf.gz`

### **5. Per-chromosome split pileups**
- `out/pileup/split_chr/<sample>.<CHR>.vcf.gz`

### **6. Merged VCFs (per chromosome/region)**
- `out/merge/merged.<CHR>.all.vcf.gz`  
  or  
- `out/merge/merged.<CHR>.probes.vcf.gz` *(if probes are used)*

### **7. Genotype-called VCF after merge**
- `out/merge/merged.<CHR>.called.vcf.gz`

### **8. Summary reports**
Located in `reports/`:
- `read_counts.tsv` — raw vs trimmed read counts  
- `flagstat_summary.tsv` — QC summary per sample  
- `timing_samples.tsv` and `timing_merge.tsv` — runtime tracking  
- `table_snps_count_last_by_scaffold.tsv` — SNP summary per chromosome (optional)

---

## Directory Structure Created Automatically

ut/
├── bam/
│ ├── <sample>.sorted.group.bam
│ └── <sample>.sorted.group.bam.bai
│
├── bam_tmp/
│ ├── <sample>.flagstat.txt
│ ├── <sample>.stats.txt
│ ├── <sample>.idxstats.txt
│ └── <sample>.bamvalidate.txt
│
├── pileup/
│ ├── <sample>_sorted_norm_split.vcf.gz
│ ├── <sample>_sorted_norm_split.vcf.gz.tbi
│ │
│ └── split_chr/
│ ├── <sample>.<CHR>.vcf.gz
│ └── <sample>.<CHR>.vcf.gz.tbi
│
└── merge/
├── merged.<CHR>.all.vcf.gz
├── merged.<CHR>.probes.vcf.gz
├── merged.<CHR>.called.vcf.gz
└── *.tbi

